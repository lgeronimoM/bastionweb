<html>
<head>
  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/materialize.min.css' ) }}"  media="screen,projection"/>
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% block title %}{% endblock title %}</title>
  <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='img/logo.png' ) }}" /> 
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css' ) }}">
  <meta charset="utf-8">
</head>
<body class="">
<header>
</header>
<div class="navbar-fixed">
  <nav class="navmain">
    <div class="nav-wrapper container">
      <ul id="nav-mobile" class="left hide-on-med-and-down">
        <li><i class="material-icons white-text">account_circle</i></li>
        <li style="margin-right: 50px;">{{user}}</li>
      </ul>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li><i class="material-icons white-text">widgets</i></li>
        <li style="margin-right: 50px;"><a href="https://github.com/lgeronimoM/bastionweb">Proyecto Github</a></li>
        <li><i class="material-icons white-text">storage</i></li>
        <li style="margin-right: 50px;"> <a href="/admin">adminBD</a></li>
        <li><i class="material-icons darken-4"><b>exit_to_app</b></i></li>
        <li style="margin-right: 50px;" class="left"><a href="/logout">Salir</a></li>
      </ul>
    </div>
  </nav>
</div>
<div class="container row section">
  <div class="col s12 m6 l6">
    <h3 style="font-family: 'Roboto', sans-serif; font-weight: bold;"><img class="responsive-img" src="{{ url_for('static', filename='img/logo.png' ) }}" style="width: 80px;"> BastionHost</h3>
    <p>Aplicación web versión 2.0 multi-task.</p>
  </div>
  <div class="col s12 m6 l6">
    <div class="row menu-navbar center">
      <div class="col s3">
        <a href="/">
          <i class="medium material-icons black-text text-darken-4">home</i>
        </a>
        <p>Inicio</p>
        <div class="line"></div>
      </div>
      <div class="col s3">
        <a href="/users">
          <i class="medium material-icons black-text text-darken-4">supervisor_account</i>
        </a>
        <p>Usuarios</p>
        <div class="line"></div>
      </div>
      <div class="col s3">
        <a href="/servers">
          <i class="medium material-icons black-text text-darken-4">devices</i>
        </a>
        <p>Servidores</p>
        <div class="line"></div>
      </div>
      <div class="col s3">
        <a href="/bastion">
          <i class="medium material-icons black-text text-darken-4">vpn_key</i>
        </a>
        <p>Accesos</p>
        <div class="line"></div>
      </div>
    </div>
  </div>
</div>
{% block content %} 

{% endblock content %}
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    $('select').formSelect();
  });
</script>
<script src="{{ url_for('static', filename='js/select_search.js') }}"></script>
<script type="text/javascript">
  $(function () {
    $("#chkPassport").click(function () {
      if ($(this).is(":checked")) {
        $("#dvPassport").show();
        $("#AddPassport").hide();
      } else {
        $("#dvPassport").hide();
        $("#AddPassport").show();
      }
    });
  });

  //Add a JQuery click event handler onto our checkbox.
  $('#terms_and_conditions').click(function(){
    //If the checkbox is checked.
    if($(this).is(':checked')){
      //Enable the submit button.
      $('#submit_button').attr("disabled", false);
    } else{
      //If it is not checked, disable the button.
      $('#submit_button').attr("disabled", true);
    }
  });

  function habilitarBotones() {
    var checkboxes = document.querySelectorAll('#activeEditor');
    var botones = document.querySelectorAll('#regenAvalive');

    var alMenosUnCheckboxSeleccionado = false;

    checkboxes.forEach(function(checkbox) {
      if (checkbox.checked) {
        alMenosUnCheckboxSeleccionado = true;
      }
    });

    botones.forEach(function(boton) {
      boton.disabled = !alMenosUnCheckboxSeleccionado;
    });
  }

  function obtenerValores() {
    var checkboxes = document.querySelectorAll('#activeEditor:checked');
    var valoresSeleccionados = [];

    checkboxes.forEach(function(checkbox) {
      valoresSeleccionados.push(checkbox.value);
    });

    // Enviar los valores seleccionados al servidor
    document.getElementById("valoresSeleccionados").value = valoresSeleccionados.join(',');

    // Enviar el formulario al servidor
    document.getElementById("miFormulario").submit();
  }
</script>

<!--modal para contenido del log -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var logButton = document.getElementById('logButton');
    var logModal = document.getElementById('logModal');
    var logContent = document.getElementById('log-content');
    var closeButton = document.getElementById('closeButton');

    // Inicializar el modal
    var modalInstance = M.Modal.init(logModal, {});

    // Agregar evento click al botón para mostrar el modal
    logButton.addEventListener('click', function() {
      // Hacer la solicitud al servidor para obtener el log
      fetch('/get_log')
        .then(response => response.text())
        .then(data => {
          // Colocar el contenido del log en el elemento pre dentro del modal
          logContent.textContent = data;

          // Abrir el modal
          modalInstance.open();
        })
        .catch(error => {
          console.error('Error al obtener el log:', error);
        });
    });

    // Agregar evento click al botón de cerrar modal
    closeButton.addEventListener('click', function() {
      // Cerrar el modal
      modalInstance.close();
    });
  });      
</script>

<!--modal para loading -->
<script> 
  document.addEventListener('DOMContentLoaded', function() {
    var modal = document.getElementById("miModal");
    var instance = M.Modal.init(modal, {dismissible: false});

    window.mostrarPreload = function() {
      deshabilitarModal();
      instance.open();
    };

    window.habilitarModal = function() {
      instance.options.dismissible = true;
      modal.style.pointerEvents = "auto";
    };

    window.deshabilitarModal = function() {
      instance.options.dismissible = false;
      modal.style.pointerEvents = "none";
    };

    // Inicializar el modal al cargar el contenido
    var elems = document.querySelectorAll('.modal');
    var instances = M.Modal.init(elems);
  });
</script>

<!--cerrar session al cerrar la ventana -->
<script>
  // Función para enviar una solicitud AJAX para cerrar la sesión
  function cerrarSesion() {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', '/logout', true);  // Ruta para cerrar sesión en tu aplicación Flask
      xhr.send();
  }
  
  // Evento que se activa al cerrar la ventana
  window.addEventListener('unload', function() {
      cerrarSesion();
  });
</script>

</body>
</html>